<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
     <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Student Management System</h1>
        <div class="student-info">
            <div><strong>Full Name:</strong> Mohammad Zaid</div>
            <div><strong>NUID:</strong> 002562992</div>
        </div>
    </div>

    <div class="success-message" id="successMessage"></div>

    <div class="controls">
        <button class="btn btn-primary" id="addStudentBtn">Add New Student</button>
        <button class="btn btn-submit" id="submitBtn" disabled>Submit</button>
    </div>
     <div class="table-container">
        <table id="studentTable">
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Expand</th>
                    <th>Student ID</th>
                    <th>Student Name</th>
                    <th>Advisor</th>
                    <th>Award Status</th>
                    <th>Semester</th>
                    <th>Type</th>
                    <th>Budget</th>
                    <th>Percentage</th>
                    <th>Delete</th>
                    <th>Edit</th>
                </tr>
            </thead>
            <tbody id="studentTableBody">
                <tr data-student-id="1">
                    <td class="checkbox-container">
                        <input type="checkbox" class="row-checkbox" data-row="1">
                    </td>
                    <td>
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2334C759'%3E%3Cpath d='M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z'/%3E%3C/svg%3E" alt="Expand" class="expand-icon" data-row="1">
                    </td>
                    <td>1</td>
                    <td>Student 1</td>
                    <td>Teacher 1</td>
                    <td>Approved</td>
                    <td>Fall 2024</td>
                    <td>TA</td>
                    <td>$5000</td>
                    <td>100%</td>
                    <td class="delete-column"></td>
                    <td class="edit-column"></td>
                </tr>
                <tr class="expandable-row" data-parent="1">
                    <td colspan="12">
                        <div class="expandable-content">
                            <h4>Additional Details for Student 1</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Email</div>
                                    <div class="detail-value">student1@university.edu</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Program</div>
                                    <div class="detail-value">Computer Science MS</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">GPA</div>
                                    <div class="detail-value">3.85</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Start Date</div>
                                    <div class="detail-value">September 2024</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Research Area</div>
                                    <div class="detail-value">Machine Learning</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">Active</div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr data-student-id="2">
                    <td class="checkbox-container">
                        <input type="checkbox" class="row-checkbox" data-row="2">
                    </td>
                    <td>
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2334C759'%3E%3Cpath d='M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z'/%3E%3C/svg%3E" alt="Expand" class="expand-icon" data-row="2">
                    </td>
                    <td>2</td>
                    <td>Student 2</td>
                    <td>Teacher 2</td>
                    <td>Under Review</td>
                    <td>Fall 2024</td>
                    <td>RA</td>
                    <td>$4500</td>
                    <td>85%</td>
                    <td class="delete-column"></td>
                    <td class="edit-column"></td>
                </tr>
                <tr class="expandable-row" data-parent="2">
                    <td colspan="12">
                        <div class="expandable-content">
                            <h4>Additional Details for Student 2</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Email</div>
                                    <div class="detail-value">student2@university.edu</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Program</div>
                                    <div class="detail-value">Data Science PhD</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">GPA</div>
                                    <div class="detail-value">3.92</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Start Date</div>
                                    <div class="detail-value">September 2024</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Research Area</div>
                                    <div class="detail-value">Natural Language Processing</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">Active</div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr data-student-id="3">
                    <td class="checkbox-container">
                        <input type="checkbox" class="row-checkbox" data-row="3">
                    </td>
                    <td>
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2334C759'%3E%3Cpath d='M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z'/%3E%3C/svg%3E" alt="Expand" class="expand-icon" data-row="3">
                    </td>
                    <td>3</td>
                    <td>Student 3</td>
                    <td>Teacher 3</td>
                    <td>Approved</td>
                    <td>Spring 2025</td>
                    <td>TA</td>
                    <td>$5200</td>
                    <td>95%</td>
                    <td class="delete-column"></td>
                    <td class="edit-column"></td>
                </tr>
                <tr class="expandable-row" data-parent="3">
                    <td colspan="12">
                        <div class="expandable-content">
                            <h4>Additional Details for Student 3</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Email</div>
                                    <div class="detail-value">student3@university.edu</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Program</div>
                                    <div class="detail-value">Software Engineering MS</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">GPA</div>
                                    <div class="detail-value">3.78</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Start Date</div>
                                    <div class="detail-value">January 2025</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Research Area</div>
                                    <div class="detail-value">Web Development</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">Active</div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
   
    <!-- Edit Popup -->
    <div class="popup" id="editPopup">
        <div class="popup-content">
            <h3 id="editTitle">Edit Student Details</h3>
            <input type="text" id="editInput" placeholder="Enter new details...">
            <div class="popup-buttons">
                <button class="btn btn-primary" id="editOkBtn">OK</button>
                <button class="btn btn-delete" id="editCancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let studentCounter = 3;
        let nextAvailableId = 4;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateSubmitButton();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Add new student button
            document.getElementById('addStudentBtn').addEventListener('click', addNewStudent);

            // Submit button (placeholder functionality)
            document.getElementById('submitBtn').addEventListener('click', function() {
                if (!this.disabled) {
                    showSuccessMessage('Data submitted successfully!');
                }
            });
             // Checkbox change events
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('row-checkbox')) {
                    handleRowSelection(e.target);
                }
            });

            // Expand icon clicks
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('expand-icon')) {
                    toggleExpandableRow(e.target);
                }
            });

            // Delete button clicks
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-delete') && !e.target.id.startsWith('edit')) {
                    deleteStudent(e.target);
                }
            });

            // Edit button clicks
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-edit')) {
                    editStudent(e.target);
                }
            });

            // Edit popup events
            document.getElementById('editOkBtn').addEventListener('click', handleEditOk);
            document.getElementById('editCancelBtn').addEventListener('click', closeEditPopup);
            
            // Close popup when clicking outside
            document.getElementById('editPopup').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditPopup();
                }
            });
        }
        // func to add a new student
        function addNewStudent() {
            try {
                const tbody = document.getElementById('studentTableBody');
                const studentId = nextAvailableId;
                
                // Create main row
                const newRow = document.createElement('tr');
                newRow.setAttribute('data-student-id', studentId);
                
                const budgets = ['$4800', '$5000', '$5200', '$4500', '$5500'];
                const percentages = ['90%', '95%', '100%', '85%', '88%'];
                const statuses = ['Approved', 'Under Review', 'Pending', 'Approved'];
                const semesters = ['Fall 2024', 'Spring 2025', 'Summer 2025'];
                const types = ['TA', 'RA', 'GA'];
                
                newRow.innerHTML = `
                    <td class="checkbox-container">
                        <input type="checkbox" class="row-checkbox" data-row="${studentId}">
                    </td>
                    <td>
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2334C759'%3E%3Cpath d='M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z'/%3E%3C/svg%3E" alt="Expand" class="expand-icon" data-row="${studentId}">
                    </td>
                    <td>${studentId}</td>
                    <td>Student ${studentId}</td>
                    <td>Teacher ${studentId}</td>
                    <td>${statuses[Math.floor(Math.random() * statuses.length)]}</td>
                    <td>${semesters[Math.floor(Math.random() * semesters.length)]}</td>
                    <td>${types[Math.floor(Math.random() * types.length)]}</td>
                    <td>${budgets[Math.floor(Math.random() * budgets.length)]}</td>
                    <td>${percentages[Math.floor(Math.random() * percentages.length)]}</td>
                    <td class="delete-column"></td>
                    <td class="edit-column"></td>
                `;

                // Create expandable row
                const expandableRow = document.createElement('tr');
                expandableRow.className = 'expandable-row';
                expandableRow.setAttribute('data-parent', studentId);
                
                const programs = ['Computer Science MS', 'Data Science PhD', 'Software Engineering MS', 'Information Systems MS'];
                const gpas = ['3.85', '3.92', '3.78', '3.95', '3.88'];
                const researchAreas = ['Machine Learning', 'Natural Language Processing', 'Web Development', 'Data Analytics', 'Cybersecurity'];
                
                expandableRow.innerHTML = `
                    <td colspan="12">
                        <div class="expandable-content">
                            <h4>Additional Details for Student ${studentId}</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">Email</div>
                                    <div class="detail-value">student${studentId}@university.edu</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Program</div>
                                    <div class="detail-value">${programs[Math.floor(Math.random() * programs.length)]}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">GPA</div>
                                    <div class="detail-value">${gpas[Math.floor(Math.random() * gpas.length)]}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Start Date</div>
                                    <div class="detail-value">${new Date().toLocaleDateString('en-US', {month: 'long', year: 'numeric'})}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Research Area</div>
                                    <div class="detail-value">${researchAreas[Math.floor(Math.random() * researchAreas.length)]}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">Active</div>
                                </div>
                            </div>
                        </div>
                    </td>
                `;

                tbody.appendChild(newRow);
                tbody.appendChild(expandableRow);
                
                studentCounter++;
                nextAvailableId++;
                
                showSuccessMessage(`Student ${studentId} Record added successfully`);
                
            } catch (error) {
                showSuccessMessage('Error: Failed to add student record', true);
            }
        }

        // function for Row Selection
        function handleRowSelection(checkbox) {
            const row = checkbox.closest('tr');
            const studentId = checkbox.getAttribute('data-row');
            const deleteColumn = row.querySelector('.delete-column');
            const editColumn = row.querySelector('.edit-column');

            if (checkbox.checked) {
                // Select row
                row.classList.add('selected');
                
                // Add delete button
                if (!deleteColumn.querySelector('.btn-delete')) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-delete';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.setAttribute('data-student-id', studentId);
                    deleteColumn.appendChild(deleteBtn);
                }
                
                // Add edit button
                if (!editColumn.querySelector('.btn-edit')) {
                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-edit';
                    editBtn.textContent = 'Edit';
                    editBtn.setAttribute('data-student-id', studentId);
                    editColumn.appendChild(editBtn);
                }
            } else {
                // Deselect row
                row.classList.remove('selected');
                
                // Remove buttons
                deleteColumn.innerHTML = '';
                editColumn.innerHTML = '';
            }

            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            
            if (checkedBoxes.length > 0) {
                submitBtn.disabled = false;
                submitBtn.classList.add('enabled');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('enabled');
            }
        }

        function toggleExpandableRow(icon) {
            const row = icon.getAttribute('data-row');
            const expandableRow = document.querySelector(`.expandable-row[data-parent="${row}"]`);
            const expandableContent = expandableRow.querySelector('.expandable-content');
            
            icon.classList.toggle('rotated');
            expandableContent.classList.toggle('show');
        }

        function deleteStudent(button) {
            const studentId = button.getAttribute('data-student-id');
            const mainRow = document.querySelector(`tr[data-student-id="${studentId}"]`);
            const expandableRow = document.querySelector(`.expandable-row[data-parent="${studentId}"]`);
            
            if (mainRow && expandableRow) {
                mainRow.remove();
                expandableRow.remove();
                
                // Update next available ID to maintain order
                updateStudentNumbers();
                
                showSuccessMessage(`Student ${studentId} Record deleted successfully`);
                updateSubmitButton();
            }
        }